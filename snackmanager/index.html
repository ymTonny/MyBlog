<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>é›¶é£Ÿä¿è´¨æœŸç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #FF6B6B;
            --primary-dark: #ee5a5a;
            --warning: #FFD93D;
            --danger: #FF6B6B;
            --success: #6BCB77;
            --info: #4D96FF;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #e9ecef;
        }

        html {
            height: 100%;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100%;
            padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px));
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: env(safe-area-inset-top, 20px) 20px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
        }

        .header .subtitle {
            font-size: 12px;
            opacity: 0.9;
            text-align: center;
            margin-top: 5px;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: var(--card-bg);
            padding: 15px 10px;
            margin: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-item .number {
            font-size: 26px;
            font-weight: 700;
            line-height: 1.2;
        }

        .stat-item .number.danger {
            color: var(--danger);
        }

        .stat-item .number.warning {
            color: #e6b800;
        }

        .stat-item .number.success {
            color: var(--success);
        }

        .stat-item .label {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 2px;
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            margin: 10px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            border: none;
            background: none;
            font-size: 14px;
            color: var(--text-light);
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
            -webkit-appearance: none;
            appearance: none;
        }

        .tab.active {
            color: var(--primary);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
        }

        .tab .badge {
            background: var(--danger);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 4px;
            display: none;
            vertical-align: middle;
        }

        .tab .badge.show {
            display: inline-block;
        }

        .content {
            padding: 10px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.15s ease-out;
        }

        .card:active {
            transform: scale(0.99);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            word-break: break-word;
        }

        .card-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .card-status.danger {
            background: rgba(255, 107, 107, 0.15);
            color: var(--danger);
        }

        .card-status.warning {
            background: rgba(255, 217, 61, 0.25);
            color: #b38600;
        }

        .card-status.normal {
            background: rgba(107, 203, 119, 0.15);
            color: #4a9c4d;
        }

        .card-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 13px;
            color: var(--text-light);
        }

        .card-info span {
            display: flex;
            align-items: center;
            gap: 5px;
            word-break: break-word;
        }

        .card-info span.full-width {
            grid-column: span 2;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-light);
        }

        .btn:active {
            transform: scale(0.97);
            opacity: 0.9;
        }

        .fab {
            position: fixed;
            bottom: calc(20px + env(safe-area-inset-bottom, 0px));
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 999;
            -webkit-appearance: none;
            appearance: none;
        }

        .fab:hover {
            transform: scale(1.05);
        }

        .fab:active {
            transform: scale(0.95);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 2000;
            padding: 0;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
            margin-top: auto;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top, 0px));
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--card-bg);
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
            line-height: 1;
            -webkit-appearance: none;
            appearance: none;
        }

        .modal-body {
            padding: 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: white;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .form-group input::placeholder {
            color: #bbb;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .modal-footer {
            padding: 16px 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            position: sticky;
            bottom: 0;
            background: var(--card-bg);
        }

        .modal-footer .btn {
            flex: 1;
            padding: 14px 16px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 15px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .quick-action {
            background: var(--bg);
            border: none;
            padding: 16px 10px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }

        .quick-action:active {
            background: #e9ecef;
        }

        .quick-action.selected {
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid var(--primary);
        }

        .quick-action .icon {
            font-size: 28px;
            margin-bottom: 6px;
            display: block;
        }

        .quick-action span {
            font-size: 12px;
            color: var(--text-light);
        }

        .search-box {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .search-box input {
            flex: 1;
            border: none;
            font-size: 15px;
            outline: none;
            background: transparent;
        }

        .filter-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }

        .filter-tags::-webkit-scrollbar {
            display: none;
        }

        .filter-tag {
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            white-space: nowrap;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            -webkit-appearance: none;
            appearance: none;
        }

        .filter-tag.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-tag:active {
            transform: scale(0.97);
        }

        .countdown {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .countdown.danger {
            background: rgba(255, 107, 107, 0.15);
            color: var(--danger);
        }

        .countdown.warning {
            background: rgba(255, 217, 61, 0.25);
            color: #b38600;
        }

        .countdown.safe {
            background: rgba(107, 203, 119, 0.15);
            color: #4a9c4d;
        }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 3000;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            max-width: 80%;
            text-align: center;
            word-break: break-word;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .scanner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .scanner-overlay.show {
            display: flex;
        }

        .scanner-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: calc(env(safe-area-inset-top, 20px) + 20px) 20px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            z-index: 10;
        }

        .scanner-header h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .scanner-close {
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            padding: 10px;
            line-height: 1;
        }

        #scannerVideo {
            width: 100%;
            max-width: 400px;
            height: auto;
            max-height: 60vh;
            object-fit: cover;
            border-radius: 12px;
        }

        .scanner-tip {
            color: white;
            text-align: center;
            margin-top: 20px;
            padding: 0 20px;
            font-size: 14px;
            opacity: 0.8;
        }

        .scanner-tips {
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-top: 15px;
            padding: 0 20px;
            font-size: 12px;
        }

        .scanner-tips p {
            margin: 4px 0;
        }

        .manual-input {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            padding: 0 20px;
            max-width: 400px;
            width: 100%;
        }

        .manual-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            text-align: center;
        }

        .manual-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .manual-input button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }

        @media (max-width: 380px) {
            .card-info {
                grid-template-columns: 1fr;
            }
            .card-info span.full-width {
                grid-column: span 1;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .fab {
                bottom: calc(20px + env(safe-area-inset-bottom));
            }
        }

        .header-actions {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .header-btn:active {
            background: rgba(255, 255, 255, 0.3);
        }

        .settings-modal .modal-content {
            padding-bottom: 0;
        }

        .settings-list {
            padding: 0;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .settings-item:active {
            background-color: var(--bg);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item .label {
            font-size: 15px;
            color: var(--text);
        }

        .settings-item .value {
            font-size: 13px;
            color: var(--text-light);
        }

        .settings-item .arrow {
            color: var(--text-light);
            font-size: 12px;
        }

        .data-info {
            background: var(--bg);
            padding: 12px 20px;
            font-size: 12px;
            color: var(--text-light);
        }

        .file-input {
            display: none;
        }

        .import-status {
            text-align: center;
            padding: 20px;
        }

        .import-status.success {
            color: var(--success);
        }

        .import-status.error {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¿ é›¶é£Ÿä¿è´¨æœŸç®¡ç†</h1>
        <div class="subtitle">å°å–éƒ¨ä¸“ç”¨</div>
        <div class="header-actions">
            <button class="header-btn" id="settingsBtn">âš™ï¸</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-item">
            <div class="number danger" id="expiredCount">0</div>
            <div class="label">å·²è¿‡æœŸ</div>
        </div>
        <div class="stat-item">
            <div class="number warning" id="expiringCount">0</div>
            <div class="label">å³å°†åˆ°æœŸ</div>
        </div>
        <div class="stat-item">
            <div class="number success" id="normalCount">0</div>
            <div class="label">æ­£å¸¸</div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" data-tab="all">å…¨éƒ¨</button>
        <button class="tab" data-tab="expired">
            å·²è¿‡æœŸ
            <span class="badge" id="expiredBadge">0</span>
        </button>
        <button class="tab" data-tab="expiring">
            å³å°†åˆ°æœŸ
            <span class="badge" id="expiringBadge">0</span>
        </button>
    </div>

    <div class="content">
        <div class="search-box">
            <span>ğŸ”</span>
            <input type="text" id="searchInput" placeholder="æœç´¢é›¶é£Ÿåç§°...">
        </div>

        <div class="filter-tags">
            <button class="filter-tag active" data-filter="all">å…¨éƒ¨</button>
            <button class="filter-tag" data-filter="é›¶é£Ÿ">é›¶é£Ÿ</button>
            <button class="filter-tag" data-filter="é¥®æ–™">é¥®æ–™</button>
            <button class="filter-tag" data-filter="ç³–æœ">ç³–æœ</button>
            <button class="filter-tag" data-filter="è†¨åŒ–">è†¨åŒ–</button>
            <button class="filter-tag" data-filter="å…¶ä»–">å…¶ä»–</button>
        </div>

        <div id="snackList"></div>
    </div>

    <button class="fab" id="addBtn">+</button>

    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ·»åŠ é›¶é£Ÿ</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quick-actions">
                    <button class="quick-action" data-category="é›¶é£Ÿ">
                        <span class="icon">ğŸª</span>
                        <span>é›¶é£Ÿ</span>
                    </button>
                    <button class="quick-action" data-category="é¥®æ–™">
                        <span class="icon">ğŸ¥¤</span>
                        <span>é¥®æ–™</span>
                    </button>
                    <button class="quick-action" data-category="ç³–æœ">
                        <span class="icon">ğŸ¬</span>
                        <span>ç³–æœ</span>
                    </button>
                    <button class="quick-action" data-category="è†¨åŒ–">
                        <span class="icon">ğŸŸ</span>
                        <span>è†¨åŒ–</span>
                    </button>
                    <button class="quick-action" data-category="å…¶ä»–">
                        <span class="icon">ğŸ“¦</span>
                        <span>å…¶ä»–</span>
                    </button>
                    <button class="quick-action" id="scanQr">
                        <span class="icon">ğŸ“·</span>
                        <span>æ‰«ç </span>
                    </button>
                </div>
                <div class="form-group">
                    <label>é›¶é£Ÿåç§° *</label>
                    <input type="text" id="snackName" placeholder="è¾“å…¥é›¶é£Ÿåç§°" autocomplete="off">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>åˆ†ç±»</label>
                        <select id="snackCategory">
                            <option value="é›¶é£Ÿ">é›¶é£Ÿ</option>
                            <option value="é¥®æ–™">é¥®æ–™</option>
                            <option value="ç³–æœ">ç³–æœ</option>
                            <option value="è†¨åŒ–">è†¨åŒ–</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ•°é‡</label>
                        <input type="number" id="snackQuantity" value="1" min="1" step="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ç”Ÿäº§æ—¥æœŸ *</label>
                        <input type="date" id="snackProductionDate">
                    </div>
                    <div class="form-group">
                        <label>ä¿è´¨æœŸ(å¤©) *</label>
                        <input type="number" id="snackShelfLife" placeholder="å¦‚: 180" min="1" step="1">
                    </div>
                </div>
                <div class="form-group">
                    <label>è¿›è´§ä»·(å…ƒ)</label>
                    <input type="number" id="snackCost" placeholder="0.00" step="0.01" min="0" inputmode="decimal">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <input type="text" id="snackRemark" placeholder="å¯é€‰" autocomplete="off">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAdd">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmAdd">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç¼–è¾‘é›¶é£Ÿ</h2>
                <button class="modal-close" id="closeEditModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>é›¶é£Ÿåç§° *</label>
                    <input type="text" id="editName" placeholder="è¾“å…¥é›¶é£Ÿåç§°" autocomplete="off">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>åˆ†ç±»</label>
                        <select id="editCategory">
                            <option value="é›¶é£Ÿ">é›¶é£Ÿ</option>
                            <option value="é¥®æ–™">é¥®æ–™</option>
                            <option value="ç³–æœ">ç³–æœ</option>
                            <option value="è†¨åŒ–">è†¨åŒ–</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ•°é‡</label>
                        <input type="number" id="editQuantity" value="1" min="1" step="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ç”Ÿäº§æ—¥æœŸ *</label>
                        <input type="date" id="editProductionDate">
                    </div>
                    <div class="form-group">
                        <label>ä¿è´¨æœŸ(å¤©) *</label>
                        <input type="number" id="editShelfLife" placeholder="å¦‚: 180" min="1" step="1">
                    </div>
                </div>
                <div class="form-group">
                    <label>è¿›è´§ä»·(å…ƒ)</label>
                    <input type="number" id="editCost" placeholder="0.00" step="0.01" min="0" inputmode="decimal">
                </div>
                <div class="form-group">
                    <label>å¤‡æ³¨</label>
                    <input type="text" id="editRemark" placeholder="å¯é€‰" autocomplete="off">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelEdit">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmEdit">æ›´æ–°</button>
            </div>
        </div>
    </div>

    <div class="scanner-overlay" id="scannerOverlay">
        <div class="scanner-header">
            <h3>æ‰«ç å½•å…¥</h3>
            <button class="scanner-close" id="closeScanner">&times;</button>
        </div>
        <video id="scannerVideo" playsinline webkit-playsinline></video>
        <p class="scanner-tip">å°†æ¡å½¢ç å¯¹å‡†æ¡†å†…å³å¯è‡ªåŠ¨è¯†åˆ«</p>
        <div class="scanner-tips">
            <p>ğŸ“‹ iOS ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨éœ€ï¼š</p>
            <p>è®¾ç½® â†’ Safari â†’ å…è®¸ç½‘ç«™è®¿é—®ç›¸æœº</p>
        </div>
        <div class="manual-input">
            <input type="text" id="manualBarcode" placeholder="æˆ–æ‰‹åŠ¨è¾“å…¥æ¡å½¢ç " autocomplete="off">
            <button id="confirmBarcode">ç¡®å®š</button>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <div class="modal settings-modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ•°æ®ç®¡ç†</h2>
                <button class="modal-close" id="closeSettings">&times;</button>
            </div>
            <div class="data-info" id="dataInfo">
                å…± <span id="totalCount">0</span> æ¡è®°å½•
            </div>
            <div class="settings-list">
                <div class="settings-item" id="exportData">
                    <span class="label">ğŸ“¤ å¯¼å‡ºæ•°æ®</span>
                    <span class="arrow">â€º</span>
                </div>
                <div class="settings-item" id="importData">
                    <span class="label">ğŸ“¥ å¯¼å…¥æ•°æ®</span>
                    <span class="arrow">â€º</span>
                </div>
                <div class="settings-item" id="clearData">
                    <span class="label">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</span>
                    <span class="arrow">â€º</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeSettingsBtn" style="flex:1">å…³é—­</button>
            </div>
        </div>
    </div>

    <input type="file" id="importFile" class="file-input" accept=".json">

    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script>
        const STORAGE_KEY = 'snack_inventory';
        let snacks = [];
        let currentTab = 'all';
        let currentFilter = 'all';
        let searchKeyword = '';
        let html5QrCode = null;
        let isScanning = false;

        function init() {
            loadData();
            renderSnacks();
            updateStats();
            updateDataInfo();
            setDefaultDate();
            bindEvents();
        }

        function loadData() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                try {
                    snacks = JSON.parse(data);
                } catch (e) {
                    console.error('æ•°æ®è§£æå¤±è´¥', e);
                    snacks = [];
                }
            }
        }

        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(snacks));
            } catch (e) {
                console.error('æ•°æ®ä¿å­˜å¤±è´¥', e);
                showToast('æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­˜å‚¨ç©ºé—´');
            }
        }

        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('snackProductionDate').value = today;
        }

        function bindEvents() {
            const addBtn = document.getElementById('addBtn');
            const addModal = document.getElementById('addModal');
            const closeModal = document.getElementById('closeModal');
            const cancelAdd = document.getElementById('cancelAdd');
            const confirmAdd = document.getElementById('confirmAdd');

            addBtn.addEventListener('click', function(e) {
                e.preventDefault();
                addModal.classList.add('show');
                setDefaultDate();
                document.body.style.overflow = 'hidden';
            });

            function closeAddModal() {
                addModal.classList.remove('show');
                clearForm();
                document.body.style.overflow = '';
            }

            closeModal.addEventListener('click', closeAddModal);
            cancelAdd.addEventListener('click', closeAddModal);
            confirmAdd.addEventListener('click', addSnack);

            addModal.addEventListener('click', function(e) {
                if (e.target === e.currentTarget) {
                    closeAddModal();
                }
            });

            const editModal = document.getElementById('editModal');
            const closeEditModal = document.getElementById('closeEditModal');
            const cancelEdit = document.getElementById('cancelEdit');
            const confirmEdit = document.getElementById('confirmEdit');

            function closeEditFn() {
                editModal.classList.remove('show');
                document.body.style.overflow = '';
            }

            closeEditModal.addEventListener('click', closeEditFn);
            cancelEdit.addEventListener('click', closeEditFn);
            confirmEdit.addEventListener('click', updateSnack);

            editModal.addEventListener('click', function(e) {
                if (e.target === e.currentTarget) {
                    closeEditFn();
                }
            });

            document.querySelectorAll('.tab').forEach(function(tab) {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(function(t) {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    currentTab = tab.dataset.tab;
                    renderSnacks();
                });
            });

            document.querySelectorAll('.filter-tag').forEach(function(tag) {
                tag.addEventListener('click', function() {
                    document.querySelectorAll('.filter-tag').forEach(function(t) {
                        t.classList.remove('active');
                    });
                    tag.classList.add('active');
                    currentFilter = tag.dataset.filter;
                    renderSnacks();
                });
            });

            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchKeyword = e.target.value.trim().toLowerCase();
                renderSnacks();
            });

            document.querySelectorAll('.quick-action[data-category]').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    document.getElementById('snackCategory').value = btn.dataset.category;
                    document.querySelectorAll('.quick-action').forEach(function(b) {
                        b.classList.remove('selected');
                    });
                    btn.classList.add('selected');
                });
            });

            const scanQr = document.getElementById('scanQr');
            const scannerOverlay = document.getElementById('scannerOverlay');
            const closeScanner = document.getElementById('closeScanner');
            const confirmBarcode = document.getElementById('confirmBarcode');
            const manualBarcode = document.getElementById('manualBarcode');

            scanQr.addEventListener('click', function() {
                startScanner();
            });

            closeScanner.addEventListener('click', function() {
                stopScanner();
            });

            scannerOverlay.addEventListener('click', function(e) {
                if (e.target === e.currentTarget) {
                    stopScanner();
                }
            });

            confirmBarcode.addEventListener('click', function() {
                const barcode = manualBarcode.value.trim();
                if (barcode) {
                    stopScanner();
                    handleBarcodeScan(barcode);
                }
            });

            manualBarcode.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmBarcode.click();
                }
            });

            var settingsBtn = document.getElementById('settingsBtn');
            var settingsModal = document.getElementById('settingsModal');
            var closeSettings = document.getElementById('closeSettings');
            var closeSettingsBtn = document.getElementById('closeSettingsBtn');
            var exportData = document.getElementById('exportData');
            var importData = document.getElementById('importData');
            var clearData = document.getElementById('clearData');
            var importFile = document.getElementById('importFile');

            function closeSettingsFn() {
                settingsModal.classList.remove('show');
                document.body.style.overflow = '';
            }

            settingsBtn.addEventListener('click', function() {
                updateDataInfo();
                settingsModal.classList.add('show');
                document.body.style.overflow = 'hidden';
            });

            closeSettings.addEventListener('click', closeSettingsFn);
            closeSettingsBtn.addEventListener('click', closeSettingsFn);

            settingsModal.addEventListener('click', function(e) {
                if (e.target === e.currentTarget) {
                    closeSettingsFn();
                }
            });

            exportData.addEventListener('click', function() {
                exportDataToFile();
            });

            importData.addEventListener('click', function() {
                importFile.click();
            });

            importFile.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    importDataFromFile(e.target.files[0]);
                }
            });

            clearData.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    if (confirm('å†æ¬¡ç¡®è®¤ï¼šç¡®å®šè¦åˆ é™¤æ‰€æœ‰é›¶é£Ÿè®°å½•å—ï¼Ÿ')) {
                        snacks = [];
                        saveData();
                        renderSnacks();
                        updateStats();
                        updateDataInfo();
                        showToast('æ•°æ®å·²æ¸…ç©º');
                    }
                }
            });
        }

        function isHttps() {
            return location.protocol === 'https:' || 
                   location.hostname === 'localhost' || 
                   location.hostname === '127.0.0.1';
        }

        function checkCameraPermission() {
            return navigator.permissions && navigator.permissions.query({ name: 'camera' })
                .then(function(permissionStatus) {
                    return permissionStatus.state;
                })
                .catch(function() {
                    return 'unknown';
                });
        }

        function requestCameraPermission() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                return navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
                    .then(function(stream) {
                        stream.getTracks().forEach(function(track) {
                            track.stop();
                        });
                        return true;
                    })
                    .catch(function() {
                        return false;
                    });
            }
            return Promise.resolve(false);
        }

        function startScanner() {
            const scannerOverlay = document.getElementById('scannerOverlay');
            scannerOverlay.classList.add('show');
            document.body.style.overflow = 'hidden';

            if (typeof Html5Qrcode === 'undefined') {
                showToast('æ‰«ç åŠŸèƒ½åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...');
                setTimeout(function() {
                    if (typeof Html5Qrcode !== 'undefined') {
                        initScanner();
                    } else {
                        showToast('æ‰«ç åŠŸèƒ½åŠ è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥');
                        stopScanner();
                    }
                }, 1500);
                return;
            }

            if (!isHttps()) {
                showToast('è¯·ä½¿ç”¨ HTTPS è®¿é—®ä»¥å¯ç”¨æ‰«ç åŠŸèƒ½ï¼Œæˆ–æ‰‹åŠ¨è¾“å…¥æ¡å½¢ç ');
                stopScanner();
                return;
            }

            initScanner();
        }

        function initScanner() {
            var videoElement = document.getElementById('scannerVideo');
            
            html5QrCode = new Html5Qrcode("scannerVideo");
            
            var config = {
                fps: 10,
                qrbox: { width: 250, height: 120 },
                aspectRatio: 1.5,
                disableFlip: false,
                verbose: false
            };

            var constraints = {
                video: {
                    facingMode: "environment",
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };

            html5QrCode.start(
                constraints,
                config,
                onScanSuccess,
                onScanFailure
            ).then(function() {
                isScanning = true;
                showToast('å°†æ¡å½¢ç å¯¹å‡†æ¡†å†…');
            }).catch(function(err) {
                console.error('ç›¸æœºå¯åŠ¨å¤±è´¥:', err);
                handleScannerError(err);
            });
        }

        function handleScannerError(err) {
            var errorMsg = 'æ— æ³•å¯åŠ¨ç›¸æœº';
            
            if (err.name === 'NotAllowedError' || err.message.indexOf('Permission') !== -1) {
                errorMsg = 'ç›¸æœºæƒé™è¢«æ‹’ç»ï¼Œè¯·åˆ°è®¾ç½®ä¸­å…è®¸è®¿é—®ç›¸æœº';
            } else if (err.name === 'NotFoundError' || err.message.indexOf('No camera') !== -1) {
                errorMsg = 'æœªæ£€æµ‹åˆ°ç›¸æœºè®¾å¤‡';
            } else if (err.name === 'NotReadableError' || err.message.indexOf('in use') !== -1) {
                errorMsg = 'ç›¸æœºæ­£åœ¨è¢«å…¶ä»–åº”ç”¨ä½¿ç”¨';
            } else if (!isHttps()) {
                errorMsg = 'æ‰«ç åŠŸèƒ½éœ€è¦ HTTPS ç¯å¢ƒï¼Œè¯·æ‰‹åŠ¨è¾“å…¥æ¡å½¢ç ';
            }
            
            showToast(errorMsg);
            stopScanner();
        }

        function onScanSuccess(decodedText, decodedResult) {
            if (isScanning) {
                isScanning = false;
                stopScanner();
                handleBarcodeScan(decodedText);
            }
        }

        function onScanFailure(error) {
        }

        function stopScanner() {
            const scannerOverlay = document.getElementById('scannerOverlay');
            scannerOverlay.classList.remove('show');
            document.body.style.overflow = '';
            document.getElementById('manualBarcode').value = '';

            if (html5QrCode && isScanning) {
                html5QrCode.stop().then(function() {
                    html5QrCode.clear();
                    isScanning = false;
                }).catch(function(err) {
                    console.error('åœæ­¢æ‰«ç å¤±è´¥:', err);
                    html5QrCode = null;
                    isScanning = false;
                });
            }
        }

        function handleBarcodeScan(barcode) {
            const addModal = document.getElementById('addModal');
            addModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            document.getElementById('snackName').value = barcode;
            document.getElementById('snackName').focus();
            showToast('å·²è¯†åˆ«æ¡å½¢ç : ' + barcode);
        }

        function clearForm() {
            document.getElementById('snackName').value = '';
            document.getElementById('snackQuantity').value = '1';
            document.getElementById('snackShelfLife').value = '';
            document.getElementById('snackCost').value = '';
            document.getElementById('snackRemark').value = '';
            document.querySelectorAll('.quick-action').forEach(function(b) {
                b.classList.remove('selected');
            });
        }

        function addSnack() {
            const name = document.getElementById('snackName').value.trim();
            const category = document.getElementById('snackCategory').value;
            const quantity = parseInt(document.getElementById('snackQuantity').value, 10) || 1;
            const productionDate = document.getElementById('snackProductionDate').value;
            const shelfLife = parseInt(document.getElementById('snackShelfLife').value, 10);
            const cost = parseFloat(document.getElementById('snackCost').value) || 0;
            const remark = document.getElementById('snackRemark').value.trim();

            if (!name || !productionDate || !shelfLife) {
                showToast('è¯·å¡«å†™å¿…å¡«é¡¹');
                return;
            }

            const snack = {
                id: Date.now(),
                name: name,
                category: category,
                quantity: quantity,
                productionDate: productionDate,
                shelfLife: shelfLife,
                cost: cost,
                remark: remark,
                createdAt: new Date().toISOString()
            };

            snacks.unshift(snack);
            saveData();
            renderSnacks();
            updateStats();
            document.getElementById('addModal').classList.remove('show');
            clearForm();
            document.body.style.overflow = '';
            showToast('æ·»åŠ æˆåŠŸ');
        }

        function updateSnack() {
            const id = parseInt(document.getElementById('editId').value, 10);
            const name = document.getElementById('editName').value.trim();
            const category = document.getElementById('editCategory').value;
            const quantity = parseInt(document.getElementById('editQuantity').value, 10) || 1;
            const productionDate = document.getElementById('editProductionDate').value;
            const shelfLife = parseInt(document.getElementById('editShelfLife').value, 10);
            const cost = parseFloat(document.getElementById('editCost').value) || 0;
            const remark = document.getElementById('editRemark').value.trim();

            if (!name || !productionDate || !shelfLife) {
                showToast('è¯·å¡«å†™å¿…å¡«é¡¹');
                return;
            }

            const index = snacks.findIndex(function(s) {
                return s.id === id;
            });
            if (index !== -1) {
                snacks[index] = {
                    id: id,
                    name: name,
                    category: category,
                    quantity: quantity,
                    productionDate: productionDate,
                    shelfLife: shelfLife,
                    cost: cost,
                    remark: remark,
                    createdAt: snacks[index].createdAt
                };
                saveData();
                renderSnacks();
                updateStats();
                document.getElementById('editModal').classList.remove('show');
                document.body.style.overflow = '';
                showToast('æ›´æ–°æˆåŠŸ');
            }
        }

        function deleteSnack(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé›¶é£Ÿå—ï¼Ÿ')) {
                snacks = snacks.filter(function(s) {
                    return s.id !== id;
                });
                saveData();
                renderSnacks();
                updateStats();
                showToast('å·²åˆ é™¤');
            }
        }

        function editSnack(id) {
            const snack = snacks.find(function(s) {
                return s.id === id;
            });
            if (snack) {
                document.getElementById('editId').value = snack.id;
                document.getElementById('editName').value = snack.name;
                document.getElementById('editCategory').value = snack.category;
                document.getElementById('editQuantity').value = snack.quantity;
                document.getElementById('editProductionDate').value = snack.productionDate;
                document.getElementById('editShelfLife').value = snack.shelfLife;
                document.getElementById('editCost').value = snack.cost;
                document.getElementById('editRemark').value = snack.remark || '';
                document.getElementById('editModal').classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function getSnackStatus(snack) {
            const productionDate = new Date(snack.productionDate);
            const expirationDate = new Date(productionDate);
            expirationDate.setDate(productionDate.getDate() + snack.shelfLife);

            const today = new Date();
            const daysLeft = Math.ceil((expirationDate - today) / (1000 * 60 * 60 * 24));

            if (daysLeft < 0) {
                return { status: 'danger', label: 'å·²è¿‡æœŸ', daysLeft: daysLeft, class: 'danger' };
            } else if (daysLeft <= 7) {
                return { status: 'warning', label: 'å³å°†åˆ°æœŸ', daysLeft: daysLeft, class: 'warning' };
            } else {
                return { status: 'normal', label: 'æ­£å¸¸', daysLeft: daysLeft, class: 'safe' };
            }
        }

        function getCategoryIcon(category) {
            var icons = {
                'é›¶é£Ÿ': 'ğŸª',
                'é¥®æ–™': 'ğŸ¥¤',
                'ç³–æœ': 'ğŸ¬',
                'è†¨åŒ–': 'ğŸŸ',
                'å…¶ä»–': 'ğŸ“¦'
            };
            return icons[category] || 'ğŸ“¦';
        }

        function updateStats() {
            var expired = 0;
            var expiring = 0;
            var normal = 0;
            var i;

            for (i = 0; i < snacks.length; i++) {
                var status = getSnackStatus(snacks[i]);
                if (status.status === 'danger') {
                    expired++;
                } else if (status.status === 'warning') {
                    expiring++;
                } else {
                    normal++;
                }
            }

            document.getElementById('expiredCount').textContent = expired;
            document.getElementById('expiringCount').textContent = expiring;
            document.getElementById('normalCount').textContent = normal;

            var expiredBadge = document.getElementById('expiredBadge');
            var expiringBadge = document.getElementById('expiringBadge');

            if (expired > 0) {
                expiredBadge.textContent = expired;
                expiredBadge.classList.add('show');
            } else {
                expiredBadge.classList.remove('show');
            }

            if (expiring > 0) {
                expiringBadge.textContent = expiring;
                expiringBadge.classList.add('show');
            } else {
                expiringBadge.classList.remove('show');
            }
        }

        function renderSnacks() {
            var filtered = snacks;
            var i;

            if (currentTab === 'expired') {
                filtered = filtered.filter(function(s) {
                    return getSnackStatus(s).status === 'danger';
                });
            } else if (currentTab === 'expiring') {
                filtered = filtered.filter(function(s) {
                    return getSnackStatus(s).status === 'warning';
                });
            }

            if (currentFilter !== 'all') {
                filtered = filtered.filter(function(s) {
                    return s.category === currentFilter;
                });
            }

            if (searchKeyword) {
                filtered = filtered.filter(function(s) {
                    return s.name.toLowerCase().indexOf(searchKeyword) !== -1 ||
                           (s.remark && s.remark.toLowerCase().indexOf(searchKeyword) !== -1);
                });
            }

            var container = document.getElementById('snackList');

            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><p>æš‚æ— é›¶é£Ÿè®°å½•</p></div>';
                return;
            }

            var html = '';
            for (i = 0; i < filtered.length; i++) {
                var snack = filtered[i];
                var status = getSnackStatus(snack);
                var productionDate = new Date(snack.productionDate);
                var expirationDate = new Date(productionDate);
                expirationDate.setDate(productionDate.getDate() + snack.shelfLife);

                var countdownText;
                if (status.daysLeft < 0) {
                    countdownText = 'è¿‡æœŸ' + Math.abs(status.daysLeft) + 'å¤©';
                } else {
                    countdownText = 'å‰©ä½™' + status.daysLeft + 'å¤©';
                }

                html += '<div class="card" data-id="' + snack.id + '">';
                html += '<div class="card-header">';
                html += '<span class="card-title">' + getCategoryIcon(snack.category) + ' ' + escapeHtml(snack.name) + '</span>';
                html += '<span class="card-status ' + status.status + '">' + status.label + '</span>';
                html += '</div>';
                html += '<div class="card-info">';
                html += '<span>ğŸ“¦ æ•°é‡: ' + snack.quantity + '</span>';
                html += '<span>ğŸ·ï¸ ' + snack.category + '</span>';
                html += '<span>ğŸ“… ç”Ÿäº§: ' + snack.productionDate + '</span>';
                html += '<span>â° åˆ°æœŸ: ' + expirationDate.toLocaleDateString() + '</span>';
                html += '<span>ğŸ’° è¿›ä»·: Â¥' + snack.cost.toFixed(2) + '</span>';
                html += '<span class="countdown ' + status.class + '">' + countdownText + '</span>';
                if (snack.remark) {
                    html += '<span class="full-width">ğŸ“ ' + escapeHtml(snack.remark) + '</span>';
                }
                html += '</div>';
                html += '<div class="card-actions">';
                html += '<button class="btn btn-outline" onclick="window.editSnack(' + snack.id + ')">ç¼–è¾‘</button>';
                html += '<button class="btn btn-danger" onclick="window.deleteSnack(' + snack.id + ')">åˆ é™¤</button>';
                html += '</div>';
                html += '</div>';
            }

            container.innerHTML = html;
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateDataInfo() {
            document.getElementById('totalCount').textContent = snacks.length;
        }

        function exportDataToFile() {
            if (snacks.length === 0) {
                showToast('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }

            var exportData = {
                version: '1.0',
                exportTime: new Date().toISOString(),
                count: snacks.length,
                data: snacks
            };

            var jsonStr = JSON.stringify(exportData, null, 2);
            var blob = new Blob([jsonStr], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            
            var dateStr = new Date().toISOString().split('T')[0];
            var fileName = 'snacks_backup_' + dateStr + '.json';
            
            var a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.style.display = 'none';
            document.body.appendChild(a);
            
            if (typeof a.click === 'function') {
                a.click();
            } else {
                var event = document.createEvent('MouseEvents');
                event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                a.dispatchEvent(event);
            }
            
            setTimeout(function() {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);

            showToast('å·²å¯¼å‡º ' + snacks.length + ' æ¡è®°å½•');
        }

        function importDataFromFile(file) {
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var imported = JSON.parse(e.target.result);
                    
                    if (!imported.data || !Array.isArray(imported.data)) {
                        showToast('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                        return;
                    }

                    var importCount = imported.data.length;
                    
                    if (importCount === 0) {
                        showToast('æ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®');
                        return;
                    }

                    var mergeMode = confirm(
                        'å³å°†å¯¼å…¥ ' + importCount + ' æ¡è®°å½•ã€‚\n\n' +
                        'ç‚¹å‡»ã€Œç¡®å®šã€åˆå¹¶åˆ°ç°æœ‰æ•°æ®ï¼ˆä¿ç•™ä¸¤æ¡è®°å½•ï¼‰ã€‚\n' +
                        'ç‚¹å‡»ã€Œå–æ¶ˆã€æ›¿æ¢æ‰€æœ‰ç°æœ‰æ•°æ®ã€‚'
                    );

                    if (mergeMode) {
                        var oldCount = snacks.length;
                        snacks = snacks.concat(imported.data);
                        showToast('å·²åˆå¹¶ï¼Œæ–°å¢ ' + importCount + ' æ¡ï¼ˆæ€»è®¡ ' + snacks.length + ' æ¡ï¼‰');
                    } else {
                        if (confirm('ç¡®å®šè¦æ›¿æ¢æ‰€æœ‰ç°æœ‰æ•°æ®å—ï¼ŸåŸæœ‰æ•°æ®å°†ä¸¢å¤±ï¼')) {
                            snacks = imported.data;
                            showToast('å·²æ›¿æ¢ä¸º ' + importCount + ' æ¡è®°å½•');
                        } else {
                            return;
                        }
                    }

                    saveData();
                    renderSnacks();
                    updateStats();
                    updateDataInfo();
                } catch (err) {
                    console.error('å¯¼å…¥å¤±è´¥:', err);
                    showToast('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯');
                }
                document.getElementById('importFile').value = '';
            };
            reader.onerror = function() {
                showToast('è¯»å–æ–‡ä»¶å¤±è´¥');
                document.getElementById('importFile').value = '';
            };
            reader.readAsText(file);
        }

        function showToast(message) {
            var toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(function() {
                toast.classList.remove('show');
            }, 2500);
        }

        init();
    </script>
</body>
</html>
